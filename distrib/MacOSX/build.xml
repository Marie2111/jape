<project>
    <!-- ../camlengine/_buildOSX/jape_engine must be built before Jape.app (see makefile) -->
    
    <property name="copyright"       value="Copyright &#xa9; Richard Bornat and Bernard Sufrin"/>
    <property name="launcherApple"   value="build/Jape.app/Contents/MacOS/JavaApplicationStub"/>
    
    <property environment="env" />

    <taskdef name="jarbundler" 
         classname="net.sourceforge.jarbundler.JarBundler" />
      
    <target name="Jape-1.7.app" 
            description="Build the application for java 1.7 using appbundler to make the structure">
    
    <taskdef name="bundleapp"
                 classpath= "${appbundler.jar}" 
                 classname= "com.oracle.appbundler.AppBundlerTask"/>
        <mkdir dir="build1.7"/>   
        <bundleapp  outputdirectory= "build1.7" 
                    name=           "Jape"
                    displayname=    "Jape"
                    mainclassname=  "uk.org.jape.Jape"
                    identifier=     "uk.org.jape.Jape"
                    icon=           "Jape.icns"
                    copyright=       "${ant.project.name} ${builddate} ${copyright}"
                    shortversion=   "${version}"
                    >
          
          <classpath file="../java_GUI/build/jar/OSX/Jape.jar"/>
    
    
          <!-- This packages the entire runtime (>100mb) -->
          
            <!-- <runtime dir="${env.JAVA_HOME}"/> -->
            <!--
          
            <option value="-Dapple.laf.useScreenMenuBar=true"/>
            <option value="-Dapple.laf.useScreenMenuBar=true"/>
            <option value="-Dapple.awt.showGrowBox=true"/>
            <option value="-Dapple.awt.antialiasing=true"/>
            <option value="-Dapple.awt.rendering=quality"/>
            
            -->
            <option value="-Duk.org.jape.AppPackage=$APP_PACKAGE"/> 
            
           
            
          <!-- -->
                    
        </bundleapp>
        
        <mkdir dir="build1.7/Jape.app/Contents/Engine"/>
        <copy overwrite="true"
              file="Info.plist.prototype" 
              tofile="build1.7/Jape.app/Contents/Info.plist"/>
        <copy file="universalbootstrap.prototype"
              tofile="build1.7/Jape.app/Contents/MacOS/universalbootstrap"/>       
        <exec executable="chmod">
            <arg value="755"/>
            <arg value="build1.7/Jape.app/Contents/MacOS/universalbootstrap"/>
        </exec>
        <copy file="../camlengine/_buildOSX/jape_engine" 
              tofile="build1.7/Jape.app/Contents/Engine/jape_engine"/>
        <exec executable="chmod">
            <arg value="755"/>
            <arg value="build1.7/Jape.app/Contents/Engine/jape_engine"/>
        </exec>
        
        
      </target>
        
    
    <target name="Jape.app"
            description="Build the application as for java 1.6 using JarBundler-2.5.0 to make the structure and universalJavaApplicationStub to launch it">
        <mkdir dir="build"/>
        <jarbundler dir="build"
                    name="Jape"
                    mainclass="uk.org.jape.Jape"
                    jar="../java_GUI/build/jar/OSX/Jape.jar"
                    shortname="Jape"
                    icon="Jape.icns"
                    stubfile="universalJavaApplicationStub"
                    useJavaXKey="true"
                    version="${guiversion}"
                    >
            
            <javaproperty name="apple.laf.useScreenMenuBar" value="true"/>
            <javaproperty name="apple.awt.showGrowBox"      value="true"/>
            <javaproperty name="apple.awt.antialiasing"     value="true"/>
            <javaproperty name="apple.awt.rendering"        value="quality"/>
            <javaproperty name="uk.org.jape.AppPackage"     value="$APP_PACKAGE"/>
            <documenttype name="Jape Theory"
                                extensions= "jt,j,jp" 
                                ostypes=    "****" 
                                iconfile=   "Jape.icns"
                                role=       "None"/>
        </jarbundler>
            
        <mkdir dir="build/Jape.app/Contents/Engine"/>
        <copy file="../camlengine/_buildOSX/jape_engine" tofile="build/Jape.app/Contents/Engine/jape_engine"/>
        <exec executable="chmod">
            <arg value="755"/>
            <arg value="build/Jape.app/Contents/Engine/jape_engine"/>
        </exec>
        
        <!-- <exec executable="./macunsign">
                 <arg value="${launcherApple}"/>
             </exec>
        -->
        
    </target>
    
    <target name="clean">
        <delete dir="build"/>
        <delete dir="build1.7"/>
    </target>
    
</project>








