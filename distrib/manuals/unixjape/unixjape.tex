\documentclass{article}
\newcommand{\htmladdnormallinkfoot}[2]{#1\footnote{#2}}
\usepackage{array}
\usepackage{jape}
\usepackage{alltt}
\makeindex

\parindent=0pt
\parskip=\medskipamount
\flushbottom

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\button#1{\fbox{\scriptsize\tt #1}}

\def\Index#1{#1\index{#1}\xspace}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\usepackage{cframed}

\newenvironment{framed}[1][4in]{%
\begin{center}
\begin{tabular}{|c|}\hline\\
\begin{minipage}{#1}}{%
\end{minipage}\\\\\hline
\end{tabular}
\end{center}}
 
\newenvironment{cframed}[1][4in]{%
\begin{framed}[#1]\begin{center}}{\end{center}\end{framed}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{The Unix Jape Companion}
\author{Bernard Sufrin%
\thanks{Computing Laboratory and Worcester College, Oxford University}
\\and\\
Richard Bornat%
\thanks{Queen Mary and Westfield College, London University}}
\date{For Jape Version 5.0b5\\February 2002}
\newcommand{\link}[2]{\htmladdnormallinkfoot{{\it #1}}{#2}}
\begin{document}
\vfill
\maketitle
\vfill
\newpage
\begin{abstract}
\noindent In this document we briefly describe the Unix Jape user interface then 
give a fuller description of the auxiliary programs which may be used to edit Jape 
theories, print Jape proofs, incorporate Jape proofs in
Latex documents, and construct new Jape font encodings.
\end{abstract}
\newpage
\tableofcontents
\newpage
\section{The Unix Jape System}
When the Unix \Jape  system is installed properly it inhabits a 
tree rooted in a directory which we will
refer to, in this document,  as {\tt JAPEHOME} -- your Jape administrator
will tell you the path to this at your installation.\footnote{At Oxford it is \texttt{/ecslab/pl/JAPEHOME}}

The best way of making the \Jape system and its programs available to
you is to add the directory {\tt JAPEHOME/bin} to your Unix
\Index{{\tt PATH} environment variable}. You may also find it useful
to make a symbolic link point to the {\tt JAPEHOME/} directory from
directories in which you do a lot of \Jape work.

In the rest of this document we will assume that you've done both these things.

For our running example theory we will use the single conclusion
sequent calculus, which is found in the file {\tt
JAPEHOME/examples/SCS.jt}. That  theory has many user-interface
features in common with the other example theories, but we use
it here simply as an illustration.  Many \Jape theories have
handbooks of their own, describing the details of
the user interface their designers have adopted.

\section{The Unix Jape Interface}
\subsection{Starting \Jape{} -- loading a theory}
Unix \Jape can be started from an X terminal by giving the Unix command
\begin{alltt}
        jape
\end{alltt}

It signals its presence by giving a report 
on the terminal which looks something like this

\begin{small}
\begin{verbatim}
Jape proof engine: release 5.0b5 [/ecslab/pl/JAPEHOME/bin/GUI/japeserver.py]
\end{verbatim}
\end{small}

and by putting up a session window (see \FIGREF{session1}). 

\JPSFIG[scale=0.45]{session1}{A \Jape Session Window}


The {\tt File} menu can then be used to select a top-level \Index{theory file}
to work with. This is done by clicking on {\tt File}, then
clicking on the topmost menu entry of the File menu (see \FIGREF{filemenu}),
and then using the dialogue box which appears (\FIGREF{theorydialogue1})
to select a theory ({\tt .jt}) file. If there are no \Jape theories
in your current directory, then you may 
double click on the name of a directory in
order to change the directory to one where there are theories
(see, for example, \FIGREF{theorydialogue2}).
\JPSFIG[scale=0.75]{filemenu}{The \Jape{} {\tt File} menu}
\JPSFIG[scale=0.75]{theorydialogue1}{A \Jape theory dialogue (the {\tt JAPEHOME/examples} directory)}
\JPSFIG[scale=0.75]{theorydialogue2}{A \Jape theory dialogue (the examples \texttt{sequent\_calculus} subdirectory}

Double-clicking (with the leftmost mouse button) on a {\tt .jt}
file selects and loads it. The Session window shortly changes to
look like \FIGREF{session3}, and a new window -- the Conjectures window --
appears (see \FIGREF{conjectures}). Notice that the Session window now has
a few additional menus present: these are menus provided by the
designer of the \texttt{SCS} theory.


\JPSFIG[scale=0.45]{session3}{Session window with sequent-calculus-specific menus}
\JPSFIG[scale=0.75]{conjectures}{Conjectures window for sequent calculus}

We are now in a position to begin proving one of the example
conjectures placed in this window by the person who created
\Jape's {\tt SCS} theory.


\begin{framed}
\begin{center}
Cutting to the Chase\\
\Index{Dialogueless Theory Selection}
\end{center}
Users irritated by the theory selection dialogue at the
beginning of a \Jape session will be relieved to hear that
\Jape can be invoked directly with the name of a 
theory file on its command line.

\begin{verbatim}
        jape JAPEHOME/examples/sequent_calculus/SCS.jt
\end{verbatim}

\end{framed}

\subsection{A first \Jape Proof}

Select the conjecture $PÏ(QÏR) Ê(PÏQ)ÏR$ for  proof by double-clicking on it on the 
Conjectures panel.\footnote{or by selecting it, then clicking on the \button{Prove} button on that panel.}
The proof display in the session window changes to \JPSPROOF[scale=0.5]{SCS0} -- 
this is a display of the state of the proof we've so far discovered.

Next we decide to use the ``and-elimination'' rule to simplify
the hypothesis, so we click on \button{$¶Ê$} in the \button{Rules} menu.
The proof is now displayed as \JPSPROOF[scale=0.5]{SCS1}

The interface to this theory was designed so that
\Index{double-clicking on a hypothesis}  has the same effect as
invoking the elimination rule for the topmost operator of the
hypothesis. \index{Direct manipulation} 
Let's go back and try this method of invoking a rule
by first undoing a single step (press the backspace, or delete
key, or the \button{Undo} button on the \button{Edit} menu),
then double clicking on the hypothesis (in this case $PÏ(QÏR)$).
The proof should now resemble the one just shown.
\index{Undo}

Now let's flirt with inefficiency by starting to work on the 
conclusion of the conjecture before we have finished decomposing the
original hypothesis. The interface to {\tt SCS} was designed so that
\Index{double-clicking on a conclusion} formula invokes the introduction rule
for the topmost operator of the conclusion. In this case doing so
leaves the proof in the following state \JPSPROOF[scale=0.5]{SCS2} --
the  proof tree has split into two branches:  with goals $P,  Q¶RÊR$
and  $P,  Q¶RÊP¶Q$.

Double clicking on the second hypothesis of  the latter  yields
\JPSPROOF[scale=0.5]{SCS3} -- and double clicking on
the conclusion of the top-left goal  in this state yields
\JPSPROOF[scale=0.5]{SCS4}

The two applications of {\tt hyp} which close the left hand
subproof were invoked automatically by \Jape because the designer
of this theory directed that this be done whenever it can be
done straightforwardly.\footnote{The details of what we mean
by straightforward are a little beyond the scope of this note, but in
essence it means ``without any proof unknowns being unified''.}

The remaining subgoal yields to a click on its hypothesis.
\JPSPROOF[scale=0.5]{SCS5}

The proven conjecture is now a theorem, and can be
\index{Saving a Theorem}
saved for later application by pressing the
\button{Done} button on the 
\button{Edit} menu, or pressing the fullstop (period) key 
on the keyboard. 
The conjectures panel changes to indicate the
new status of  the original conjecture -- which is marked at the left with 
the legend \texttt{THM}.
\JPSPROOF[scale=0.75]{conjectures2}

The proof we just constructed can be displayed at any time
by clicking on  the conjecture in the conjecture panel,  then
pressing the \button{Show} button. It can henceforth be \textit{applied} -- \textit{i.e.} 
used as a proof rule in its own right during anothe proof -- by selecting it and pressing
\button{Apply} or by double clicking it.

\subsection{The \Index{ Box Display style}}
Big proofs displayed in the tree style use lots of real estate: it's
often more convenient to discover  and/or display them
in the so-called Box style. In this section we'll construct another
proof using the box style, but first we'll display the proof we just 
constructed in the box style. 

We select the box style by clicking on the \button{Box Display}
button in the \button{Edit} menu, then the proof we just
constructed can be displayed by clicking on  the conjecture in
the conjecture panel,  then pressing the \button{Show} button.
The proof display changes to
\JPSPROOF[scale=0.5]{SCS6}

In this style of  display, hypotheses are presented at the top of
a box, and conclusions at the bottom. A new level of box nesting
is started whenever a new hypothesis (or a new conclusion) appears. 

It is, perhaps, easier to understand this style of proof display if we reconstruct the
earlier proof step by step. 

To do so we  can either start another proof of the same conjecture (try it),
\index{Pruning Proofs}
or we can select the conclusion (line 10) of the proof being
shown, and use the \button{Prune} button on the \button{Edit} menu
to prune the proof tree back to the point at which that was the goal.

\begin{framed}
\begin{center}
Undoing and redoing proof steps
\end{center}

\index{Undo}
\index{Pruning Proofs}
\index{Backtrack}
Proof steps may be undone one by one by pressing the
delete or backspace or shift-Tab key (or using \button{Undo}). Undone
steps may be redone by pressing the Tab key (or \button{Redo}). 

If a conclusion is selected and  \button{Backtrack} is used,
then \Jape tries to undo {\em user-invoked} moves until the
selected conclusion appears at the fringe of the proof tree. It
may not always be possible to do so -- some nodes in the proof
tree arise from moves which are made within composite tactics.
\end{framed}

The original goal appears as:
\JPSPROOF[scale=0.5]{SCS7}

Double-clicking on the hypothesis yields the proof state
\JPSPROOF[scale=0.5]{SCS8} -- the box starting at line 2
and ending at line 3 represents the (incomplete) proof of the goal
$P,  Q¶RÊ(P¶Q)¶R$.

A single click on the conclusion at line 3 selects it as the one 
for which we're aiming, 
\index{Unuseable hypotheses}
whereupon the display changes so that hypotheses 
which aren't 
useable in the proof of the selected goal are greyed out.
\JPSPROOF[scale=0.65]{SCS9}



A double click on the conjunction at line 3 invokes the conjunction
introduction rule. This leaves the proof in the following state
\JPSPROOF[scale=0.5]{SCS10}

It's evident from this display that there are two subproofs to
be completed, but it  may not be evident which hypotheses are
available for which goal. Selecting each conclusion
in turn soon yields this information: they can both 
use the same hypotheses.

\JPSTWINPROOFS[scale=0.65]{SCS11}{SCS12}

\index{ambiguous gesture}
One consequence of this is that the meaning of a double-click
on the hypothesis $Q¶R$ is not completely obvious.  Faced with 
no extra information \Jape would respond to such  a gesture
by putting up an  error window  saying something like
``You double-clicked on an inappropriate formula''.
The gesture is simply ambiguous, since we can use
the specified rule to  extend the proof  of
the conclusion on line 3, or that of the conclusion on line 4.

\index{selecting a conclusion}
The way to indicate which conclusion we are aiming at is to
select it  (by clicking on it) before double-clicking on the
hypothesis.  Selecting line 3 before double clicking hypothesis
2.2 ($Q¶R$) leads to the proof state
\JPSPROOF[scale=0.5]{SCS13}

 It is worth taking  a moment to compare this to the 
 tree-style presentation of the  same proof state. This can be done
 by pressing the \button{Tree Display} button on the \button{Edit} menu.
 
\JPSPROOF[scale=0.5]{SCS14}

Switching back to the  box display, we complete the left branch of the
proof by  double-clicking on line 4

\JPSPROOF[scale=0.5]{SCS15}

Selecting the remaining unsatisfied goal  ($R$ on line 6) shows us
just what hypotheses are now useable:

\JPSPROOF[scale=0.65]{SCS16} -- and we can close the proof by
double-clicking twice: first on line 4, and then on hypothesis 2.2.
\JPSPROOF[scale=0.5]{SCS17}

\begin{framed}
\begin{center}
\Index{Scrolling} a large Proof
\end{center}
When a proof overflows a session window the proof display can be
scrolled by pressing
the middle mouse button well away from any formula (the cursor
turns into a hand shape) and {\em dragging} 
the  display with it.  The \button{Home} key cancels
any such scrolling that might have been done.
\end{framed}

\subsection{{Printing a Proof}}
\index{Printing a Proof}
\index{Recording a Proof}
\index{Latex (embedding proofs in)} 
The currently visible proof can be printed  by clicking on
the \button{Print Proof} button on the \button{File} menu. 
This prepares an appropriately scaled postscript file (see below) and prints it
using the current proof printing program.\footnote{
The proof printing program can be changed by using the \button{Edit Preferences} 
dialogue.}

A proof record can be prepared for printing (or embedding in a document) in one of two ways.
\begin{enumerate}
\index{Postscript (scaled)}
\item Pressing the \button{Save Proof as Postscript ({\tt .jps}) file} button on the 
\button{File} menu. This pops up a save dialogue box
in which 
you can choose a name for the file by hand 
(type it into the {\tt File:} field
at the bottom of the menu), or accept the 
name that has been chosen for you automatically. The automation
isn't particularly sophisticated -- it's designed to help the generation of
a sequence of proof pictures with related file names. The 
way in which the name is chosen is one of the 
parameters that can be set in the \button{Edit Preferences} dialogue of the
\button{File} menu. Most  of the time the orientation and scaling
chosen by \Jape for your proof will be acceptable, but you can also
fiddle with these from within the \button{Edit Preferences} dialogue.

\item 
\index{Latex (embedding proofs in)} 
Pressing the \button{Save Proof as Printable ({\tt .pjp}) file} button on the
\button{File} menu. This pops up a filename selection dialogue box.  The proof
is saved in the file you name in a form which permits it to be translated into
Latex. The program {{\tt pjp2tex}} \index{{{\tt pjp2tex}}}
does the translation.  Invoking it by
\begin{alltt}
        pjp2tex  \(filename\){\tt.pjp}
\end{alltt}
causes it to generate the file 
\begin{alltt}
        \(filename\){\tt.pjp.tex}
\end{alltt}
\end{enumerate}

The means by which proofs prepared for printing in this way are printed and/or embedded  in
Latex documents are described in Section \ref{printing}.

\subsection{\Index{Saving your work}}
Any proofs you have done can be saved for later reloading into \Jape by pressing 
\button{Save As} (or, subsequently,  \button{Save})  on the \button{File} menu. 
You will be presented with a file selection dialogue box: all the proofs  (including proofs in progress)
on which you have worked will be saved in the file you name; they may be  reloaded
subsequently by pressing  \button{Load a proof file} on the \button{File} menu,
or by putting them after the name of your theory on the command line
when you invoke jape.

\begin{comment}
\subsection{\Jape Geometry}
Unix \Jape notoriously uses many windows for most theories, and it would be a little
tedious if a user, having once  established the right \Jape layout and geometry for
working with a particular theory, had to repeat the  process for every 
\Jape session with the theory. Two buttons on the
\button{Edit} menu were designed to ameliorate this problem

        \button{\Index{Save the current theory's window layout}}

and 

        \button{\Index{Restore the current theory's window layout}}

The save (restore) a specification of the current window layout in (from)
a file whose name is derived from the name of the current theory.
\end{comment}

\subsection{{Parallel Proof Sessions}} 
\index{Concurrent Proof attempts (switch between)}
\index{Concurrent Proof attempts (abandoning)}
It's possible to be doing
several proofs in parallel. If you select a new conjecture for
proof, then the current proof session (if any) is superseded
in the session window, but you can switch between proofs (or
abandon the current proof) with the \button{{Proofs}} selection menu.



\subsection{Provisos}
So far we haven't needed to look at the \textit{provisos} window --
indeed we haven't even seen it! In our next example provisos play an
important role.\index{Provisos}


We are going to \textit{try} to prove the following conjecture,
which is not sound if $x$ appears free in $Q$.
\begin{verbatim}
        Q Ê Ë x . Q
\end{verbatim}

First we add the conjecture to the conjecture list by pressing
the \button{New} button on the conjectures menu, whereupon
a conjecture editor, which will look something
like Figure \FIGREF{Editconj} will appear.
\JPSFIG[scale=0.5]{Editconj}{The New Conjecture Editor}


Type the conjecture into the main window
of the editor, and press \button{Execute} or the
\button{Return} key to add it to the
conjectures panel (where it will automatically be selected).
Now press \button{Prove} on the conjectures panel, to starrt
the proof attempt:

\JPSPROOF[scale=0.85]{Prov1}

Double clicking on the conclusion yields

\JPSPROOF[scale=0.85]{Prov2}

\Jape has invented a variable, $m$, that doesn't
appear anywhere in the proof in order to apply the
$ÊË$ rule. 

Now, despite the fact that the $hyp$ rule looks inapplicable because
the hypothesis and conclusion are different, \Jape can be a little
more helpful because the conclusion takes the form of a
substitution.  To be precise, when asked to apply the $hyp$, \Jape
deduces that $Q$ and $Q[x\backslash{}m]$ \textit{would} be identical
provided $x$ did not appear in $Q$, and records its deduction as a
\textit{proviso} This closes the proof, but transforms the proof window to look like
\FIGREF{Prov2W}. Notice that a bottom pane has opened, and the
proviso is shown there. The height of the pane can be adjusted 
using the small square ``handle'' at its top right.

\JPSFIG[scale=0.5]{Prov2W}{A proof window with Provisos}

We normally show such proof states in documents as follows:

\JPSPROOF[scale=0.85]{Prov3}

\begin{framed}
\index{Text selection (of subformulas)} 
\index{Subformula selection} 
\begin{center}
Selection of subformulas
\end{center}

Some theories use text selection of subformulas more than others. The {\tt SCS} 
theory uses it only for supplying variables and terms when
the quantifier rules are used.

A text selection is made within a term  using the middle mouse button.
Point the cursor at the character at one end of the text to be selected, then
press the middle button whilst dragging the cursor over the text to be selected.

\index{Subformula selection (removing)} 
\index{Hypothesis selection (removing)} 
\index{Conclusion selection (removing)} 
If you make a mistake whilst doing this you can remove the
selections made within a term by double-clicking the middle
button, and you can remove all term and text selections by
clicking the left button in the proof window away from the proof
display.  
\end{framed}




\index{{\tt jlpr}}
\index{Printing a Theory}
\index{Printing a Proof}
\section{Printing Jape Theories and Proofs with {\tt jlpr}}\label{printing}
\subsection{Background}
Unix \Jape has an entry on the \fbox{File} menu which generates
encapsulated postscript ({\tt .jps}) files.
Unless they
are being printed on a system in which the \Jape special
fonts have been installed as part of the standard file spooling
service, such files will usually  need special treatment before being
sent to the printer -- the problem is that the appropriate special
font must also be sent to the printer.

The example theories which we distribute with \Jape suffer
from the same problem: a printer which hasn't been told of
the special font encoding which they use  cannot put the 
appropriate marks on the paper.

Our solution to this problem is to distribute the python scripts
{\tt proofprint}, \texttt{printableproof} and \texttt{printabletheory}
which handle the problem of identifying what font 
is used by a {\tt .jps} or a \Jape theory file, and including
that font in the postscript to send to the printer.

Printing a {\tt .jps} file is very easy -- since the file itself
contains an explicit indication of the special font it uses.
For example
\begin{verbatim}
        proofprint boxproofps.jps
\end{verbatim}
This has the same effect as
\begin{verbatim}
        printableproof boxproof.jps | lpr
\end{verbatim}

\index{Fonts (declaring in a theory)}
Printing a \Jape theory file is a bit less easy: one must declare
the names of the font and encoding being used. For example:
\begin{verbatim}
        printabletheory -Konstanz SCS_rules.j | lpr
        printabletheory -Laura    jnj.jt | lpr
\end{verbatim}

\section{Jape and Latex}


\subsection{\Jape proof files}
\index{Postscript (encapsulated)}
\index{{\tt jape} (Latex package)}
An encapsulated jape postscript ({\tt .jps}) file output by \Jape can
be included in a Latex document using the {\tt epsfig} package;
the {\tt jape} package defines commands which make this easy, and
for many purposes the ability to incorporate proofs represented
this way will be sufficient. 

\index{Latex printable proofs}
In situations where stylistic uniformity is important the
appearance of a postscript file may not be appropriate,
so Unix \Jape also has an entry on the \fbox{File} menu
which generates a ``Latex Printable \Jape proof'' ({\tt .pjp})
file from the currently-displayed proof. A {\tt.pjp} file
can be converted to Latex using the program/script {\tt pjp2tex}
which is described later; it may then be included in a Latex
document using one of the {\tt jape} package commands.

Boxed \verb".pjp" proofs are automatically split across pages if necessary. 
This makes the \verb".pjp" route  much more flexible 
for long boxed proofs than the \verb".jps" route -- which requires
proofs to fit on a single page.

\subsection{The {\tt jape} package}
A Latex document in which \Jape proofs or theories
are to be incorporated should
load the \verb.jape.  style package. 

\begin{verbatim}
        \usepackage{jape}
\end{verbatim}

This defines the following commands
and environments which are useful when writing about \Jape or
about proofs made with \Jape.
\index{Latex printable proofs (as figures)}
\index{Latex printable proofs (in line)}
\index{Postscript proofs (as figures)}
\index{Postscript  proofs (in line)}
\index{Latex (the {\tt jape} package)}

\def\bb#1{{\tt $\backslash$begin\{#1\}}}
\def\cc#1{{\tt $\backslash$#1}}
\def\oo#1{[{\it #1}]}
\def\xx#1{[{\tt #1}]}
\def\pp#1{\{{\it #1}\}}
\begin{tabular}{|l|l|}
\hline
\rm Invocation                                & \rm Description       \\\hline
\bb{jape} ...                                 & Behaves exactly like \bb{verbatim}         \\
\bb{FIG}\xx{hbtp}\pp{label}\pp{caption} ...   & Figure labelled \pp{label}{\tt-FIG} from ...       \\
\cc{FIGREF}\pp{label}                         & ``Figure \cc{ref}\pp{label}{\tt-FIG}''\\
\cc{figref}\pp{label}                         & ``Figure \cc{ref}\pp{label}''\\
\hline\hline
\cc{PJPFIG}\xx{hbtp}\pp{file}\pp{caption}     & Figure labelled \pp{file} from \pp{file}{\tt.pjp.tex} \\
\cc{PJPPROOF}\oo{sizedeclaration}\pp{file}    & Display \pp{file}{\tt.pjp.tex} at the given size.\\                                             
\hline\hline
\cc{JPSFIG}\oo{scaling}\pp{file}\pp{caption}  & Figure labelled \pp{file} from    \pp{file}{\tt.jps}.\\

\cc{JPSPROOF}\oo{scaling}\pp{file}            & Display from \pp{file}{\tt.jps}.\\
                                              & \oo{scaling} is \begin{tabular}{lll} \tt scale&=&\oo{factor}\\
                                                                                   \tt width&=&\oo{length}\\
                                                                                   \tt height&=&\oo{length}\end{tabular}\\
\hline\end{tabular}


\subsection{The {\tt jape} environment}
\index{{\tt jape} (Latex environment)}
Our first illustration is the output from a
\verb.jape. environment which contains material edited with
an eight-bit-clean editor in the {\tt Konstanz} encoding.

\begin{jape}
        RULE "ÁÊ" 
        FROM  Ç      Ê A,∆ 
        AND   Ç, B   Ê ∆                
        INFER Ç, AÁB Ê ∆
        
        RULE "ÊÈ" 
        FROM  Ç  Ê AÁB, ∆ 
        AND   Ç  Ê BÁA, ∆    
        INFER Ç  Ê AÈB, ∆
\end{jape}

If another encoding (such as the Laura encoding) is used,
then the corresponding font encoding package ({\tt laura})
must be requested {\em after} the {\tt jape} package. It isn't
possible to mix encodings in a single Latex document because
the mechanism used by \Jape's encoding files is very crude.

In fact the \verb.jape. environment is just another name for the
\verb.verbatim. environment: it comes into its own for writing
``literate \Jape'' theories, because the program {\tt tex2jape}
may be used to extract the contents of all the {\tt jape}
environments in a manuscript.


\subsection{Latex Proofs {\it vs.} Postscript Proofs}
The proofs in \FIGREF{boxproof} and \FIGREF{treeproof} were
included in this document by invoking the
commands
\begin{jape}
        \PJPFIG[h]{boxproof}{A Box-Style Proof via Latex}
        \PJPFIG[h]{treeproof}{A Tree-Style Proof via Latex}
\end{jape}
The corresponding scaleable postscript proofs in 
\FIGREF{boxproofps} and \FIGREF{treeproofps} were
included by invoking the commands
\begin{jape}
        \JPSFIG[width=4cm]{boxproofps}{A Box-Style Proof via Postscript}
        \JPSFIG[scale=0.5]{treeproofps}{A Tree-Style Proof via Postscript}
\end{jape}

\PJPFIG[h]{boxproof}{A Box-Style Proof via Latex}
\PJPFIG[h]{treeproof}{A Tree-Style Proof via Latex}
\JPSFIG[width=4cm]{boxproofps}{A Box-Style Proof via Postscript}
\JPSFIG[scale=0.5]{treeproofps}{A Tree-Style Proof via Postscript}

\index{Latex printable proofs (default size)}
The default type size for  {\tt .pjp} proofs is \verb"\normalsize" -- which
is too large for big proofs in the tree style, but just right
for proofs in the box style. We  vary the size by giving
an explicit first parameter to \verb.\PJPPROOF..

\subsection{Mathematical environments}
The \verb.jape. package also permits
characters in the $128-255$ range to 
appear as themselves in mathematical text. For
example, the formula
$$
        Ë x • ‰ y • xÈy
$$
was generated from a section of
Latex manuscript in which
the forall, exists, bullet,, and equivalence characters 
appear as themselves rather than being
coded as macros. Here's what  the section of manuscript 
looked like in the \Jape editor.
\begin{verbatim}
        $$
                Ë x • ‰ y  • xÈy
        $$
\end{verbatim}

You don't {\em have} to write your  \Jape/Latex manuscripts
in this semi-WYSIWYG style, but it can reduce  the pain of
reading the mathematical text which appears in the manuscript.

\index{{\tt dvips}}
\index{{\tt xdvi}}
\subsection{DVIPS and XDVI}
{\tt Dvips}, which is used to generate self-contained postscript files
from {\tt .dvi} files needs the environment variable 
{\tt DVIPSHEADERS} to be set to a path which includes the 
directory, {\tt JAPEHOME/fonts/GSF/}, in which the \Jape
special postscript fonts are kept, if it is to be able
to include the appropriate fonts in the postscript which it
outputs.

{\tt Xdvi}, which is often used to preview LaTeX documents
under Unix, uses Ghost\-script to process the postscript
specials generated (by default) by the {\tt epsfig} package.

\index{{\tt ghostscript}}
You must tell {Ghost\-script} where to find any special fonts
which you may have used in  the {\tt .jps} renderings of your
proofs. The best way to do this is to set the environment
variable {\tt GS\_LIB} to a path which includes the directory
in which the special postscript fonts used by \Jape are to
be found. In the standard distribution of Jape this is the
subdirectory {\tt JAPEHOME/fonts/GSF} of the Jape home
directory.

%%%\paragraph{Warning:} At the time of writing it is not clear that
%%%all Solaris configurations of Xdvi behave appropriately under
%%%these circumstances -- a symptom of inappropriate behaviour is
%%%the replacement of logical symbols by ordinary letters. We are
%%%investigating the matter further, but one sure remedy is to make
%%%a symbolic link from the current directory to the appropropriate
%%%font file file (for example {\tt JAPEHOME/fonts/GSF/Konstanz.gsf}).




\appendix
\index{Font encodings}
\index{Font encoding (Konstanz)}
\index{Font encodings (Laura)}
\index{Font encodings (defining new)}
\index{Fonts (Postscript)}
\index{Fonts (X)}

\section{Font Encodings}
A font encoding\footnote{This section may be omitted at a first reading.}
is a mapping from the character codes 0 to 255 to
a collection of glyphs (printable shapes). Most people are 
used to using one of the ISO standard font encodings (which embed
ASCII) when
editing, but since \Jape can (at present) only work
with a single font encoding, it's necessary for us to 
work with ``hybrid'' encodings which map codes to
a mix of Roman, Greek and Symbolic glyphs. 

The most frequently \Jape font encoding used with \Jape is
called ``Konstanz'' -- it has just enough mathematical and
logical symbols to make it useable. We also supply a much richer encoding
called ``Laura'' -- at present it's only used in a small number of example
theories.

A font encoding is an abstraction which manifests itself
as several different kinds of file -- all but one of which are 
derived automatically from a font encoding source file
using the Unix Jape Font kit. For example, the Konstanz encoding
is manifested as
\begin{itemize}
        \item Two Postscript fonts: {\tt Konstanz.gsf}, and {\tt Konstanztt.gsf}.
        The latter is a fixed-width font used for printing theories.
        
        \item A {\tt jed}\footnote{The Unix \Jape editor.} keyboard mapping file:
        {\tt konstanz.keys}.

        \item A family of X fonts {\tt konstanz*.bdf} (used for display purposes).  
                
        \item A Latex style file: {\tt konstanz.sty} which maps
        font codes to Latex symbols. This file must
        specified by hand.        
\end{itemize}


\section{Style files for encodings}
A \Jape encoding style file permanently binds the character codes of
exotic characters to macros which render those characters. Here is
an extract from the Konstanz encoding file {\tt konstanz.sty}
much as it would look if it were being edited with an eight-bit-clean 
editor (such as {\tt jed}) displaying with one of the Konstanz fixed-width
fonts. 

\begin{jape}
    \def\hdef#1#2{\gdef#1{\ifmmode#2\else\makebox[0.9em]{$#1$}\fi}}
    \catcode`Ç=\active \hdefÇ{\Gamma}           % code 130
    \catcode`ë=\active \hdefë{\triangleleft}    % code 145
\end{jape}

\section{Environments used by {\tt .pjp.tex} proofs}
When translating {\tt .pjp} files generated from a tree-style
display, the {\tt pjp2tex} program invokes the {\tt Treeproof}
environment and its various commands.

\subsection{{\tt Treeproof}}
The file \verb"treeproof.pjp.tex" contains:
\begin{jape}
%%%%%% File: treeproof.pjp
%%%%%% Translated by pjp2tex: ... 
%%%%%% Characters 128-255 must be catcoded active by a style file
\begin{Treeproof}
\infer[ÊÁ]{P~Ê~QÁ(P¶Q)}
          {\infer[Ê¶]{P\SepForm Q~Ê~(P¶Q)}
                     {\infer[hyp]{P\SepForm Q~Ê~P}{}
                     &
                      \infer[hyp]{P\SepForm Q~Ê~Q}{}
                     }
          }
\end{Treeproof}
\end{jape}

The workhorse used within \bb{Treeproof} ... is the command \cc{infer} which describes 
a node in the proof tree by means of the call

\cc{infer}\oo{rulename}\pp{sequent}\{$subtree$ \& $subtree$ \& ...\}. 


\subsection{{\tt Boxproof}}
The file \verb"boxproof.pjp.tex" contains:
\begin{jape}
%%%%%% File: boxproof.pjp
%%%%%% Translated by pjp2tex: 
%%%%%% Characters 128-255 must be catcoded active by a style file
\begin{Boxproof}
\Bfitch
\Line{1}{P}{assumption}{1}
\Bfitch
\Line{2}{Q}{assumption}{2}
\Line{3}{(P¶Q)}{Ê¶\SepReason ~1,2}{2}
\Efitch
\Line{4}{QÁ(P¶Q)}{ÊÁ\SepReason ~2-3}{1}
\Efitch
\end{Boxproof}
\end{jape}
The workhorse used within \bb{Boxproof} ... is the command \cc{Line} 
which describes a line in the proof by means of the call

\cc{Line}\pp{line\#}\pp{formula}\pp{reason}\pp{nextinglevel\#}

\section{Building a New Jape Font Encoding}
There are several stages to this slightly painful process:\footnote{This
section was written in about 1992 -- things have changed a little
in the world of fonts and encodings, but we haven't really had the time to
pay attention.}
\begin{enumerate}
\item Deciding on an encoding to use: in other words, mapping 
each of the (about) 256 character codes available for use in a 
Jape font to a glyph. The codes from 32 to 126 are best left
mapped to the glyphs to which they usually map in one of the
ISO encodings which embed ASCII, and the ``spare'' codes from 
0 to 7, 16 to 31, and 127 to 255
can be mapped to glyphs of the designer's choosing. 

\item Designing (or selecting) an appropriate metafont program
to draw each glyph. The Jape font package provides an extensive library
of named glyph programs to support this activity: they can be used simply
by defining an encoding file.

\item Generating screen ({\tt .bdf}) and printer ({\tt .gsf}) versions
of the font. This is the time-consuming part, but a stylised Makefile
together with some shell scripts can now be used to do it all. The
\Jape font kit (distributed from the Oxford \Jape web site) has a 
\verb"HOWTO" file which explains exactly what to do.

\item Informing Jape of the correspondence between the low
resolution and the postscript fonts. This can be done quite simply in 
one of the {\tt Jape.options} files which Jape tries to load
when it starts.  

\item Informing Jape of the correspondence between its internal
names for fonts, and the names used by X to find the fonts.
This can also be done in a {\tt Jape.options} file.

\item Generating a latex style file for the font. This is only
necessary if you plan to incorporate non-postscript renderings
of Jape proofs in Latex documents. The style
files {\tt konstanz.sty} and {\tt laura.sty} are models from
which to work.
\end{enumerate}

The process is not for the timid, and is best left to one of us.
We will be happy to answer  enquiries from those who have
a serious need to develop a new Jape font. 

If Unicode becomes truly ubiquitous, and decent renderings of
the symbolic glyphs it names become easy to acquire in all the
forms in which we need them, then none of this will be necessary.
Don't hold your breath!

\section{Customising the Unix \Jape interface}
The \button{Edit Preferences...} button on the \button{File} 
menu opens the preferences dialogue box, which enables you to set various
aspects of the user interface either for the current Jape run (using 
\button{Apply}) or indefinitely (using \button{Save}). The
dialogue is intended to be fairly self-explanatory.



\section{\Index{Editing Jape Theory Files}}
If you have an editor which accomodates font encodings with
characters in the range 128-255, and which permits you to
choose the X font you use to display material using that
encoding, then look no further: use it.

If you don't have such an editor, then you may want to use
the one Bernard uses. It is almost completely
devoid of bells, whistles, (and documentation)
but he'll let you have it if you ask hime nicely.

\section{Inventory}
In this appendix we briefly comment on the role of some of the
supporting components of the Unix \Jape distribution.

\newcommand{\inv}[1]{\index{{\tt #1}}\paragraph*{{\tt #1}}}
\inv{pjp2tex} A program which takes one of Jape's {\tt .pjp} files, and
translates it into a Latex file which can be incorporated into a Latex
file which uses the Latex2e {\tt jape} package. 

\inv{jape.sty} A package which provides various environments for
setting Jape theories and proofs in Latex documents.

\inv{konstanz.sty} A style file which implements the non-ascii characters of
the Konstanz font encoding.

\inv{laura.sty} A style file which implements the non-ascii characters of
the Laura font encoding.


\inv{box-proof.sty} Macros which implement Jape's box style proof display.

\inv{tree-proof.sty} Macros which implement Jape's tree style proof display.

\input{unixjape.ind}
\end{document}




















